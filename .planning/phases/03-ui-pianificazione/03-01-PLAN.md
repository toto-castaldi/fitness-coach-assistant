---
phase: 03-ui-pianificazione
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/sessions/SessionExerciseCard.tsx
  - src/pages/SessionDetail.tsx
autonomous: true

must_haves:
  truths:
    - "Coach can toggle is_group on any exercise in SessionDetail"
    - "Group exercises show visual badge indicator"
    - "Summary count shows how many group exercises in session"
  artifacts:
    - path: "src/components/sessions/SessionExerciseCard.tsx"
      provides: "Group toggle + badge indicator"
      contains: "is_group"
    - path: "src/pages/SessionDetail.tsx"
      provides: "Group exercises summary count"
      contains: "di gruppo"
  key_links:
    - from: "SessionExerciseCard.tsx"
      to: "onUpdate callback"
      via: "is_group property in updates"
      pattern: "onUpdate.*is_group"
---

<objective>
Add "di gruppo" toggle and visual indicators to SessionDetail planning page.

Purpose: Allow coaches to mark exercises as group exercises during session planning, with clear visual feedback showing which exercises are group exercises.

Output: SessionExerciseCard with group toggle and badge, SessionDetail with summary count.
</objective>

<execution_context>
@/home/toto/.claude/get-shit-done/workflows/execute-plan.md
@/home/toto/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-ui-pianificazione/03-CONTEXT.md
@.planning/phases/03-ui-pianificazione/03-RESEARCH.md
@src/components/sessions/SessionExerciseCard.tsx
@src/pages/SessionDetail.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add group toggle and badge to SessionExerciseCard</name>
  <files>src/components/sessions/SessionExerciseCard.tsx</files>
  <action>
Add "Di gruppo" toggle and group indicator badge to SessionExerciseCard.tsx.

**1. Add Users icon import:**
Update the lucide-react import to include Users icon:
```typescript
import { ChevronUp, ChevronDown, Trash2, Minus, Plus, RefreshCw, Users } from 'lucide-react'
```

**2. Add Badge import:**
```typescript
import { Badge } from '@/components/ui/badge'
```

**3. Add group indicator badge in exercise header:**
After the exercise name button (line ~109), add a Badge that shows when is_group is true:
```typescript
{exercise.is_group && (
  <Badge variant="secondary" className="text-xs gap-1">
    <Users className="h-3 w-3" />
    Gruppo
  </Badge>
)}
```
Position it next to the exercise name, inside the same flex container.

**4. Add group toggle below skipped toggle:**
After the existing "Saltato" toggle (lines 262-272), add a "Di gruppo" toggle following the exact same pattern:
```typescript
{/* Group toggle */}
<div className="flex items-center justify-between pt-2 border-t">
  <div className="flex items-center gap-2">
    <Users className="h-3.5 w-3.5 text-muted-foreground" />
    <Label htmlFor={`group-${exercise.id}`} className="text-xs text-muted-foreground">
      Di gruppo
    </Label>
  </div>
  <Switch
    id={`group-${exercise.id}`}
    checked={exercise.is_group || false}
    onCheckedChange={(checked) => onUpdate(exercise.id, { is_group: checked })}
  />
</div>
```

**Key pattern notes:**
- Follow existing "Saltato" toggle structure exactly
- Use same Switch component, Label styling, and border-t class
- Include Users icon in label for visual consistency with badge
- Use `exercise.is_group || false` to handle null/undefined
  </action>
  <verify>
Run `npm run build` to verify TypeScript compiles without errors.
Manual verification: Open SessionDetail page in browser, verify toggle appears below "Saltato" toggle and badge appears when toggled on.
  </verify>
  <done>
SessionExerciseCard has "Di gruppo" toggle following "Saltato" pattern, and Badge with Users icon appears when is_group is true.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add group exercises summary count to SessionDetail</name>
  <files>src/pages/SessionDetail.tsx</files>
  <action>
Add summary count showing number of group exercises in session header.

**1. Add Users icon import:**
Update the lucide-react import to include Users icon:
```typescript
import { ArrowLeft, Plus, Calendar, Building2, User, Edit2, X, Users } from 'lucide-react'
```

**2. Add group exercises count in the Exercises section header:**
In the "Esercizi ({count})" header section (around line 316-323), add the group count after the total count:
```typescript
<div className="flex items-center justify-between">
  <div className="flex items-center gap-2">
    <h2 className="text-lg font-semibold">
      Esercizi ({session.exercises?.length || 0})
    </h2>
    {(session.exercises?.filter(e => e.is_group).length || 0) > 0 && (
      <span className="text-sm text-muted-foreground flex items-center gap-1">
        <Users className="h-3.5 w-3.5" />
        {session.exercises?.filter(e => e.is_group).length} di gruppo
      </span>
    )}
  </div>
  <Button size="sm" onClick={() => setShowExercisePicker(true)}>
    <Plus className="h-4 w-4 mr-2" />
    Aggiungi
  </Button>
</div>
```

**Key pattern notes:**
- Only show count when > 0 group exercises
- Use muted-foreground color to not compete with main count
- Include Users icon for visual consistency
- Position next to main exercise count, not separate line
  </action>
  <verify>
Run `npm run build` to verify TypeScript compiles without errors.
Manual verification: Open SessionDetail page, toggle some exercises as "Di gruppo", verify count updates in real-time.
  </verify>
  <done>
SessionDetail shows "X di gruppo" count next to total exercise count when at least one exercise is marked as group.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` passes without TypeScript errors
2. Visual verification in browser:
   - SessionDetail page loads without errors
   - Each exercise card shows "Di gruppo" toggle below "Saltato" toggle
   - Toggling "Di gruppo" shows/hides "Gruppo" badge on exercise card
   - Summary count in header updates when exercises are toggled
   - Toggling works instantly (optimistic update pattern)
   - Data persists after page refresh
</verification>

<success_criteria>
- Coach can mark any exercise as "di gruppo" using toggle in SessionExerciseCard
- Group exercises display "Gruppo" badge with Users icon
- SessionDetail header shows count of group exercises when > 0
- All updates are instant (optimistic) and persist to database
- Build compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-ui-pianificazione/03-01-SUMMARY.md`
</output>
